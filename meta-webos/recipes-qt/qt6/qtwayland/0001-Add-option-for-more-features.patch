From 2ff13f7be73416e00bad72009a82f2e69fa207eb Mon Sep 17 00:00:00 2001
From: Jaeyoon Jung <jaeyoon.jung@lge.com>
Date: Wed, 14 Jul 2021 19:14:46 +0900
Subject: [PATCH] Add option for more features

Change-Id: Id757e3102d03eecd32a090b7f607cc50f4e50dd5
Upstream-Status : Inappropriate [webOS specific]
---
 src/client/configure.cmake                       | 16 ++++++++++++++++
 src/plugins/CMakeLists.txt                       |  8 ++++++--
 src/plugins/hardwareintegration/CMakeLists.txt   |  2 +-
 .../compositor/CMakeLists.txt                    |  4 +++-
 4 files changed, 26 insertions(+), 4 deletions(-)

diff --git a/src/client/configure.cmake b/src/client/configure.cmake
index 11612d11..8bd0e7ce 100644
--- a/src/client/configure.cmake
+++ b/src/client/configure.cmake
@@ -222,6 +222,22 @@ qt_feature("wayland-shm-emulation-server-buffer" PRIVATE
     LABEL "Shm emulation server buffer integration"
     CONDITION QT_FEATURE_wayland_client AND QT_FEATURE_opengl
 )
+qt_feature("wayland-eglstream-controller" PRIVATE
+    LABEL "EGLStream controller"
+    CONDITION QT_FEATURE_wayland_client
+)
+qt_feature("wayland-client-hwintegration-plugins" PRIVATE
+    LABEL "Client hardware integration plugins"
+    CONDITION QT_FEATURE_wayland_client
+)
+qt_feature("wayland-platform-plugins" PRIVATE
+    LABEL "Wayland platform plugins"
+    CONDITION QT_FEATURE_wayland_client
+)
+qt_feature("wayland-decoration-plugins" PRIVATE
+    LABEL "decoration plugins"
+    CONDITION QT_FEATURE_wayland_client
+)
 qt_configure_add_summary_section(NAME "Qt Wayland Drivers")
 qt_configure_add_summary_entry(ARGS "wayland-egl")
 qt_configure_add_summary_entry(ARGS "wayland-brcm")
diff --git a/src/plugins/CMakeLists.txt b/src/plugins/CMakeLists.txt
index ef58376a..6253156b 100644
--- a/src/plugins/CMakeLists.txt
+++ b/src/plugins/CMakeLists.txt
@@ -2,7 +2,11 @@
 
 add_subdirectory(hardwareintegration)
 if(TARGET Qt::WaylandClient)
-    add_subdirectory(platforms)
-    add_subdirectory(decorations)
+    if(QT_FEATURE_wayland_platform_plugins)
+        add_subdirectory(platforms)
+    endif()
+    if(QT_FEATURE_wayland_decoration_plugins)
+        add_subdirectory(decorations)
+    endif()
     add_subdirectory(shellintegration)
 endif()
diff --git a/src/plugins/hardwareintegration/CMakeLists.txt b/src/plugins/hardwareintegration/CMakeLists.txt
index 656b43b8..5bcf1771 100644
--- a/src/plugins/hardwareintegration/CMakeLists.txt
+++ b/src/plugins/hardwareintegration/CMakeLists.txt
@@ -1,6 +1,6 @@
 # Generated from hardwareintegration.pro.
 
-if(TARGET Qt::WaylandClient)
+if(TARGET Qt::WaylandClient AND QT_FEATURE_wayland_client_hwintegration_plugins)
     add_subdirectory(client)
 endif()
 if(TARGET Qt::WaylandCompositor)
diff --git a/src/plugins/hardwareintegration/compositor/CMakeLists.txt b/src/plugins/hardwareintegration/compositor/CMakeLists.txt
index 67ca5a4b..ead40312 100644
--- a/src/plugins/hardwareintegration/compositor/CMakeLists.txt
+++ b/src/plugins/hardwareintegration/compositor/CMakeLists.txt
@@ -6,7 +6,9 @@ if(QT_FEATURE_wayland_dmabuf_client_buffer)
 endif()
 if(QT_FEATURE_wayland_egl)
     add_subdirectory(wayland-egl)
-    add_subdirectory(wayland-eglstream-controller)
+    if(QT_FEATURE_wayland_eglstream_controller)
+        add_subdirectory(wayland-eglstream-controller)
+    endif()
 endif()
 if(QT_FEATURE_wayland_brcm)
     add_subdirectory(brcm-egl)
