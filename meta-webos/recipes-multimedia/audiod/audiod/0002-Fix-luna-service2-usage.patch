From 071f0850425c91117b6965df4e9b297296668713 Mon Sep 17 00:00:00 2001
From: Martin Jansa <martin2.jansa@lgepartner.com>
Date: Mon, 20 Mar 2023 16:23:19 +0000
Subject: [PATCH] Fix luna-service2 usage

:Release Notes:
Since luna-service2 submission 143 from September 2012 ls2 headers
should be included from luna-service2 directory.

:Detailed Notes:
Fixes:
http://gecko.lge.com:8000/Errors/Details/548219

FAILED: CMakeFiles/audiod.dir/src/AudiodCallbacks.cpp.o
TOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/recipe-sysroot-native/usr/bin/arm-webos-linux-gnueabi/arm-webos-linux-gnueabi-g++ -DAUDIOD_PALM_LEGACY -DAUDIOD_TEST_API -DENABLE_POWEROFF_REBOOT_SIGNAL -DENABLE_WAKELOCK_FOR_SLEEP_STATE -DHAS_LTTNG -DSYSTEMSOUNDS_PATH=\"/media/internal/systemsounds/\" -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/recipe-sysroot/usr/include/glib-2.0 -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/recipe-sysroot/usr/lib/glib-2.0/include -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/recipe-sysroot/usr/include/json-c -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/git/src -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/git/src/umi -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/git/src/umi/modules -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/git/src/umi/soundSettings -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/git/src/controls -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/git/src/controls/hardware -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/git/src/controls/pulse -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/git/src/modules -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/git/include/public -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/git/include -mthumb -mfpu=neon-vfpv4 -mfloat-abi=hard -mcpu=cortex-a7 -fstack-protector-strong  -O2 -D_FORTIFY_SOURCE=2 -Wformat -Wformat-security -Werror=format-security -Werror=return-type  --sysroot=TOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/recipe-sysroot  -O2 -pipe -g -feliminate-unused-debug-types -fmacro-prefix-map=TOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33=/usr/src/debug/audiod/1.0.0-161.pro.9-r33                      -fdebug-prefix-map=TOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33=/usr/src/debug/audiod/1.0.0-161.pro.9-r33                      -fdebug-prefix-map=TOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/recipe-sysroot=                      -fdebug-prefix-map=TOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/recipe-sysroot-native=  -fvisibility-inlines-hidden  -Wno-narrowing -DAUDIOD_IPC_SERVER -DBOOST_DISABLE_THREADS -D_GNU_SOURCE -Wall -DWEBOS_TARGET_MACHINE_RASPBERRYPI4 -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/recipe-sysroot/usr/include/glib-2.0 -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/recipe-sysroot/usr/lib/glib-2.0/include -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/recipe-sysroot/usr/include/glib-2.0 -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/recipe-sysroot/usr/lib/glib-2.0/include -DUSE_PMLOG_DECLARATION -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/recipe-sysroot/usr/include/glib-2.0 -ITOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/recipe-sysroot/usr/lib/glib-2.0/include -DUSE_PMLOG_DECLARATION -D_REENTRANT -D_REENTRANT -DNDEBUG -MD -MT CMakeFiles/audiod.dir/src/AudiodCallbacks.cpp.o -MF CMakeFiles/audiod.dir/src/AudiodCallbacks.cpp.o.d -o CMakeFiles/audiod.dir/src/AudiodCallbacks.cpp.o -c TOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/git/src/AudiodCallbacks.cpp
In file included from TOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/git/src/AudiodCallbacks.h:25,
                 from TOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/git/src/AudiodCallbacks.cpp:20:
TOPDIR/BUILD/work/raspberrypi4-webos-linux-gnueabi/audiod/1.0.0-161.pro.9-r33/git/src/controls/AudioMixer.h:24:10: fatal error: lunaservice.h: No such file or directory
   24 | #include <lunaservice.h>
      |          ^~~~~~~~~~~~~~~
compilation terminated.

...

:Testing Performed:
Only build tested.

:QA Notes:
No change to image.

:Issues Addressed:
[WRP-10642] Remove the temporary work around from 2012 from luna-service2 recipe
[WRP-11224] audiod: Fix luna-service2 usage
[WRP-10791] CCC: Various build fixes

Change-Id: I83616fae6fe3f4729e356f720bd93fe1bf537ade
---
Upstream-Status: Submitted [http://gpro.lge.com/c/webosose/audiod-pro/+/348186 Fix luna-service2 usage]

 include/main.h         | 2 +-
 include/messageUtils.h | 2 +-
 include/utils.h        | 2 +-
 src/main.cpp           | 2 +-
 4 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/include/main.h b/include/main.h
index 80efb24b..e22f875e 100644
--- a/include/main.h
+++ b/include/main.h
@@ -14,7 +14,7 @@
 //
 // SPDX-License-Identifier: Apache-2.0
 //New Audiod service path
-#include <lunaservice.h>
+#include <luna-service2/lunaservice.h>
 #include <utils.h>
 
 #define AUDIOD_SERVICE_PATH                 "com.webos.service.audio"
diff --git a/include/messageUtils.h b/include/messageUtils.h
index 045c4053..53ac6383 100644
--- a/include/messageUtils.h
+++ b/include/messageUtils.h
@@ -18,7 +18,7 @@
 #ifndef MESSAGEUTILS_H_
 #define MESSAGEUTILS_H_
 
-#include <lunaservice.h>
+#include <luna-service2/lunaservice.h>
 #include <pbnjson.h>
 #include <pbnjson.hpp>
 #include "log.h"
diff --git a/include/utils.h b/include/utils.h
index 93ff5db2..cfa049c9 100644
--- a/include/utils.h
+++ b/include/utils.h
@@ -19,7 +19,7 @@
 #define _UTILS_H_
 
 #include <glib.h>
-#include <lunaservice.h>
+#include <luna-service2/lunaservice.h>
 #include <pulse/module-palm-policy.h>
 #include "log.h"
 #include "ConstString.h"
diff --git a/src/main.cpp b/src/main.cpp
index d0348ed7..6d3edd92 100644
--- a/src/main.cpp
+++ b/src/main.cpp
@@ -22,7 +22,7 @@
 #include <sys/time.h>
 #include <sys/resource.h>
 #include <sstream>
-#include <lunaservice.h>
+#include <luna-service2/lunaservice.h>
 #include "log.h"
 #include "main.h"
 #include "messageUtils.h"
